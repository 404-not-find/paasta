zookeeper:
  build: ../yelp_package/dockerfiles/itest/zookeeper/
  ports:
    - 2181

mesosmaster:
  build: ../yelp_package/dockerfiles/itest/mesos/
  ports:
    - 5050
  links:
    - zookeeper
  command: 'mesos-master --zk=zk://zookeeper:2181/mesos-testcluster --registry=in_memory --quorum=1'

mesosslave:
  build: ../yelp_package/dockerfiles/itest/mesos/
  ports:
    - 5051
  links:
    - zookeeper
  environment:
    -CLUSTER: testcluster
  command: 'mesos-slave --master=zk://zookeeper:2181/mesos-testcluster'

marathon:
  build: ../yelp_package/dockerfiles/itest/marathon/
  ports:
    - 8080
  links:
    - zookeeper
  environment:
    -CLUSTER: testcluster
  command: 'marathon --zk zk://zookeeper:2181/marathon --master zk://zookeeper:2181/mesos-testcluster --no-logger'

paastatools:
  build: ../yelp_package/dockerfiles/lucid/
  links:
    - marathon
    - mesosmaster
    # - mesosslave ???
    - zookeeper
  # environment:
    # -CLUSTER: testcluster ???
  # make --no-capture global ???
  volumes:
  - ../:/work:rw
  command: 'tox -e marathon_integration_inside_container -- --no-capture paasta_metastatus.feature'
